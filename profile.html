<!DOCTYPE html>
<html lang="en">
<head>
  <script type="module" src="/layout.js"></script>
  <meta charset="UTF-8" />
  <title>Profile - chara.vault</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f4f4f8;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    .profile {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .profile img {
      width: 200px;
      height: 200px;
      border-radius: 12px;
      object-fit: cover;
      border: 2px solid #3b82f6;
      margin-bottom: 1rem;
    }
    h2 {
      margin-top: 0;
      color: #3b82f6;
    }
    .not-found {
      color: #e11d48;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="content" class="profile">
    Loading profile...
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs,
    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDDZvaWl5qwJbvPOHN1pisGwfIN2gkj1Ec",
      authDomain: "charavault-e8cf5.firebaseapp.com",
      projectId: "charavault-e8cf5",
      storageBucket: "charavault-e8cf5.firebasestorage.app",
      messagingSenderId: "385710051091",
      appId: "1:385710051091:web:a38d5ac0047ec32a0914e6",
      measurementId: "G-JNLB26DXJC",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Get username from URL like ?user=shimura
    const params = new URLSearchParams(window.location.search);
    const username = params.get("user")?.toLowerCase();

    const contentDiv = document.getElementById("content");

    if (!username) {
      contentDiv.textContent = "⚠️ No username provided in URL.";
    } else {
      async function loadProfile() {
        // Query Firestore for user with this username
        const usersRef = collection(db, "users");
        const q = query(usersRef, where("username", "==", username));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          contentDiv.innerHTML = `<p class="not-found">User "${username}" not found.</p>`;
          return;
        }

        // Get the first matching user document
        const userDoc = querySnapshot.docs[0];
        const data = userDoc.data();

        // Show user info
        contentDiv.innerHTML = `
          <img src="${data.avatarUrl || 'https://placekitten.com/200/200'}" alt="Avatar" />
          <h2>${data.username}</h2>
          <p><strong>Bio:</strong> ${data.bio || "No bio yet."}</p>
          <p><strong>Joined:</strong> ${data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString() : "Unknown"}</p>
        `;

        // TODO: Add character list later here
      }

      loadProfile();
    }
  </script>
</body>
</html>
